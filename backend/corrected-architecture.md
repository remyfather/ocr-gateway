# μ¬λ°”λ¥Έ μ—­ν•  λ¶„λ¦¬ μ•„ν‚¤ν…μ²

## π― λ¬Έμ μ  μΈμ‹

ν„μ¬ Gatewayκ°€ Producerμ™€ Consumer μ—­ν• μ„ λ¨λ‘ λ‹΄λ‹Ήν•κ³  μμ–΄ **μ—­ν•  λ¶„λ¦¬κ°€ λ…ν™•ν•μ§€ μ•μ**

## β… μ¬λ°”λ¥Έ κµ¬μ΅°

### 1. **Gateway (API Gateway) - Producer μ „μ©**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                        Gateway Service                          β”‚
β”‚                    (Producer μ—­ν• λ§)                            β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚   Controller    β”‚β”€β”€β”€β–¶β”‚   Service       β”‚β”€β”€β”€β–¶β”‚   Producer  β”‚ β”‚
β”‚  β”‚   (API)         β”‚    β”‚   (Business)    β”‚    β”‚   (Queue)   β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚                                                                 β”‚
β”‚  β€Ά API μ—”λ“ν¬μΈνΈ μ κ³µ                                           β”‚
β”‚  β€Ά μ”μ²­ κ²€μ¦ λ° λ¬Έμ„ λ¶„λ¥                                        β”‚
β”‚  β€Ά νμ— λ©”μ‹μ§€ μ „μ†΅ (Producer)                                   β”‚
β”‚  β€Ά μ‘λ‹µ λ°ν™                                                     β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 2. **OCR Worker Services - Consumer μ „μ©**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    OCR Worker Services                          β”‚
β”‚                   (Consumer μ—­ν• λ§)                             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚ Medical Receipt β”‚    β”‚ Medical Cert.   β”‚    β”‚ Admission   β”‚ β”‚
β”‚  β”‚   Worker        β”‚    β”‚   Worker        β”‚    β”‚   Worker    β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚           β”‚                       β”‚                      β”‚      β”‚
β”‚           β–Ό                       β–Ό                      β–Ό      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚   Consumer      β”‚    β”‚   Consumer      β”‚    β”‚   Consumer  β”‚ β”‚
β”‚  β”‚   (Queue)       β”‚    β”‚   (Queue)       β”‚    β”‚   (Queue)   β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚                                                                 β”‚
β”‚  β€Ά νμ—μ„ λ©”μ‹μ§€ μμ‹  (Consumer)                                 β”‚
β”‚  β€Ά OCR μ²λ¦¬ λ΅μ§ μ‹¤ν–‰                                            β”‚
β”‚  β€Ά κ²°κ³Ό μ €μ¥ λ° μ²λ¦¬                                              β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π”„ μ „μ²΄ μ•„ν‚¤ν…μ² νλ¦„

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Client        β”‚β”€β”€β”€β–¶β”‚   Gateway       β”‚β”€β”€β”€β–¶β”‚   RabbitMQ      β”‚
β”‚   (Upload)      β”‚    β”‚   (Producer)    β”‚    β”‚   (Exchange/    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”‚   Queue)        β”‚
                                              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”
                                                        β”‚
                                                        β–Ό
                                              β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β”‚   OCR Workers   β”‚
                                              β”‚   (Consumers)   β”‚
                                              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π“‹ μ—­ν• λ³„ μ±…μ„ λ…ν™•ν™”

### **Gateway Service (Producer)**

```java
β… API μ—”λ“ν¬μΈνΈ μ κ³µ
β… μ”μ²­ κ²€μ¦
β… λ¬Έμ„ λ¶„λ¥
β… νμ— λ©”μ‹μ§€ μ „μ†΅
β… μ‘λ‹µ λ°ν™
β νμ—μ„ λ©”μ‹μ§€ μμ‹  (μ κ±° ν•„μ”)
β OCR μ²λ¦¬ (μ κ±° ν•„μ”)
```

### **OCR Worker Services (Consumers)**

```java
β… νμ—μ„ λ©”μ‹μ§€ μμ‹ 
β… OCR μ²λ¦¬ λ΅μ§
β… κ²°κ³Ό μ €μ¥
β… μ—λ¬ μ²λ¦¬
β API μ—”λ“ν¬μΈνΈ μ κ³µ (μ κ±° ν•„μ”)
β λ¬Έμ„ λ¶„λ¥ (μ κ±° ν•„μ”)
```

## π€ κ°μ„  λ°©μ•

### 1. **Gatewayμ—μ„ Consumer μ κ±°**

```java
// μ κ±°ν•΄μ•Ό ν•  λ¶€λ¶„
@RabbitListener(queues = RabbitMQConfig.MEDICAL_RECEIPT_QUEUE)
public void consumeMedicalReceipt(OcrQueueMessage message) {
    // μ΄ λ¶€λ¶„μ„ λ³„λ„ OCR Workerλ΅ μ΄λ™
}
```

### 2. **λ³„λ„ OCR Worker μ„λΉ„μ¤ μƒμ„±**

```java
// μƒλ΅μ΄ OCR Worker μ„λΉ„μ¤
@Service
public class MedicalReceiptOcrWorker {

    @RabbitListener(queues = RabbitMQConfig.MEDICAL_RECEIPT_QUEUE)
    public void processMedicalReceipt(OcrQueueMessage message) {
        // OCR μ²λ¦¬ λ΅μ§
    }
}
```

### 3. **λ§μ΄ν¬λ΅μ„λΉ„μ¤ λ¶„λ¦¬**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Gateway       β”‚    β”‚   OCR Worker    β”‚    β”‚   OCR Worker    β”‚
β”‚   Service       β”‚    β”‚   Service 1     β”‚    β”‚   Service 2     β”‚
β”‚   (Port 8080)   β”‚    β”‚   (Port 8081)   β”‚    β”‚   (Port 8082)   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π― μµμΆ… κ¶μ¥ κµ¬μ΅°

### **1λ‹¨κ³„: μ—­ν•  λ¶„λ¦¬**

- Gatewayμ—μ„ Consumer μ½”λ“ μ κ±°
- Producer μ—­ν• λ§ μ μ§€

### **2λ‹¨κ³„: μ„λΉ„μ¤ λ¶„λ¦¬**

- OCR Workerλ¥Ό λ³„λ„ μ„λΉ„μ¤λ΅ λ¶„λ¦¬
- κ° λ¬Έμ„ νƒ€μ…λ³„ λ…λ¦½μ μΈ Worker

### **3λ‹¨κ³„: λ§μ΄ν¬λ΅μ„λΉ„μ¤ν™”**

- κ° μ„λΉ„μ¤λ¥Ό λ…λ¦½μ μΌλ΅ λ°°ν¬
- μ„λΉ„μ¤ κ°„ ν†µμ‹ μ€ RabbitMQλ§ μ‚¬μ©

μ΄λ ‡κ² ν•λ©΄ **λ‹¨μΌ μ±…μ„ μ›μΉ™**μ„ μ§€ν‚¤κ³  **ν™•μ¥μ„±**κ³Ό **μ μ§€λ³΄μμ„±**μ„ ν¬κ² ν–¥μƒμ‹ν‚¬ μ μμµλ‹λ‹¤! π‰
